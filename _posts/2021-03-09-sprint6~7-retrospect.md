---
title: "[NHN BaseCamp] Sprint 6,7 회고"
date: 2021-03-09 00:00:00 -0400
categories: retrospect
---

> Sprint 6: 2021.02.22 ~ 2021.02.28  
> Sprint 7: 2021.03.01 ~ 2021.03.07

## 리팩토링

개발을 완료한 후 사실 이제부터 본격적으로 시작이라는 말을 듣고 무엇을 얼마나 더 할게 있을까 했다. 처음 우리에게 주어진 과제는 리팩토링, 깨끗한 코드 만들기였다. 젠킨스를 이용해 빌드를 관리하고, 소나큐브에서 정적 결함 등의 지표를 확인하며 코드의 못난 부분을 고쳐나갔다. 소나큐브 안의 지표 중 테스트 커버리지라는 것이 있는데, 작성한 테스트 코드가 전체 코드에서 얼마나 커버를 할 수 있는지를 자동으로 분석해서 알려준다. 60% 이상을 목표로 뒤늦게나마 테스트 코드를 추가 작성하였는데, 생각보다 이 지표를 올리는 것이 만만치 않았다.  

이와 더불어 데이터모델링도 검수받는 기회가 있었는데, 우리 TF는 DB구조가 상대적으로 단순해 큰 변경이 있지는 않았다. 다만, 칼럼명이나 관계 설정 등 기본적인 부분에서 협업하기 좋은 구조의 컨벤션을 파악할 수 있어 매우 유용했다.

## 웹 서버 스케일 아웃

이후의 과제는 '웹 서버를 두 대로 늘리면' 이라는 교육과 함께 시작되었다. 처음부터 큰 규모를 잡고 시작하는 프로젝트도 있겠지만 대개는 매우 작은 단위, 하나의 웹서버와 하나의 데이터베이스만을 가지고 시작해 중간에 차츰 규모를 늘리는 과정을 겪게 된다. 그 과정을 신입 교육에서 겪을 수 있는 것은 운이 좋은 것 같다. dev 서버는 한대였는데 real 서버는 두대로 운영이 된다고 한다. 그에 따라 우리 서비스에 생길 수 있는 문제/조치해야 할 것들을 고민했다. 우선 요청이 왔을 때 두 서버에 적당히 분배해줄 장치가 필요하다. 이 역할을 해주는 장치를 로드밸런서라고 하며, L4와 L7이 대표적이다. 두 대의 서버 중 한대가 이상이 생기게 된다면 해당 서버에는 요청을 보내면 안되므로 로드밸런서는 계속 상태를 체크해주어야 한다. 따라서 서버에서는 로드밸런서가 헬스체크를 하기 위한 URL을 만들어야 한다. 또 공통으로 세션을 관리해야하고, 스토리지를 공유하여야 한다. 우리 TF는 이미 DB를 통해 세션을 관리했기 때문에 추가적인 조치가 굳이 필요하진 않았지만, 더 속도가 빨라 세션처리에서 많이 사용되는 레디스를 도입했다. 또 스토리지를 공유하기 위해 NHN Cloud에서 제공하는 Object Storage를 이용했다.

## NHN Cloud Deploy

NHN CLoud 서비스 중 Devtools > Deploy 서비스로 배포를 자동화하였다. NHN Cloud Deploy(TCD)가 좋았던 점은 간편한 배포와 배포 이력을 보다 용이하게 관리할 수 있었던 것이다. 젠킨스와도 연동이 되어 젠킨스에 요청을 보내고 빌드 파일을 받아두는 저장소 역할을 한다. 첫 배포를 한지도 얼마 되지 않아 적용하는데 쉽지만은 않았다. 아티팩트, 바이너리, 태스크 등 가이드를 읽어도 한눈에 들어오지 않았는데 배포에 대한 지식과 경험이 부족해 그랬던 것 같다. 젠킨스도 처음 사용해보는 것이다 보니 서툴어서 배포를 하는데 시도를 수십번을 했고, 팀원들에게 배포를 한번 할 때마다 오는 메일과 알림 폭탄을 보냈다..ㅎㅎ 생각보다 오래 걸렸지만 그래도 어찌저찌 무사히 배포 자동화를 완성했고, 실패 속에서 조금씩 배우고 익숙해 지는 것을 경험했다.
